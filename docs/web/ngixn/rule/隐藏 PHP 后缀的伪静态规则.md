### 规则内容



```
location / {
    try_files $uri $uri/ $uri.php?$args;
}
```



## 规则概述

这条 Nginx 配置规则用于处理对根路径（“/”）的传入请求。“try_files” 指令会按照特定顺序尝试查找文件或目录，以提供请求的服务。

## 指令解释

### 1. location /

这定义了一个配置块，适用于对服务器根路径的所有请求。也就是说，它会处理所有传入的请求，无论具体的 URL 路径如何。

### 2. try_files $uri $uri/ args

- “try_files” 是 Nginx 中一个很强大的指令，它会按照特定顺序尝试不同的文件或目录路径来处理请求。在当前这个配置中，其工作方式如下：
  - **$uri**：
    - 当有请求进来时，Nginx 首先尝试查找与请求的 URI 完全匹配的文件。例如，如果用户请求 “/index”，Nginx 就会查找名为 “index” 的文件。
    - 如果存在这样的文件，就会将其提供给客户端。
  - **$uri/**：
    - 如果与 “$uri” 对应的文件未找到，Nginx 接下来会尝试查找名称由 URI 指定的目录。比如，对于 “/article” 的请求，它会查找名为 “article” 的目录。
    - 如果该目录存在，Nginx 通常会在这个目录中查找一个默认文件（如 “index.html” 或 “index.php”，具体取决于服务器配置）并提供服务。
  - **args**：
    - 如果既未找到与 URI 对应的文件，也未找到对应的目录，Nginx 就会尝试查找名称由 URI 指定并添加.php 后缀的文件，同时会带上原始的查询参数（“$args”）。例如，对于 “/page” 的请求，它会查找 “page.php”。
    - 如果该 PHP 文件存在，Nginx 会将请求连同查询参数一起传递给 PHP 解释器进行处理。这样就能让 PHP 应用程序根据参数处理动态请求并生成响应。

## 适用场景

### 1. 复杂的 Web 应用程序

这条规则对于既有静态内容又有动态内容的复杂 Web 应用程序非常有用。例如，一个内容管理系统可能有一些静态页面（如 HTML 文件）、不同板块带有索引文件的目录，以及用于根据用户请求生成内容的动态 PHP 页面。

### 2. SEO 和用户体验

通过这种方式处理请求，可以提高搜索引擎优化（SEO）效果以及用户体验。不带文件扩展名的 URL 看起来更简洁，对用户更友好。此外，搜索引擎可能会对这类 URL 给予更好的排名，因为它们看起来更像静态内容，而静态内容通常更受青睐。

### 2. 动态参数处理

在将请求传递给 PHP 文件时包含查询参数（“$args”），可以实现对用户请求的动态处理。这对于需要根据 URL 中传递的参数处理不同操作的应用程序至关重要。例如，一个电子商务网站可能会使用查询参数来筛选产品或对结果进行排序。

## 四、配置注意事项

### 1. PHP 解释器设置

为确保 PHP 文件能被正确处理，Nginx 必须配置为将对.php 文件的请求传递给 PHP 解释器。这通常根据具体设置通过 “fastcgi_pass” 或 “php-fpm” 配置来完成。

### 2. 文件和目录权限

要确保 Nginx 尝试访问的文件和目录具有合适的权限。如果 Nginx 没有访问文件或目录的权限，就会导致出现 403 禁止访问或 404 未找到错误。

### 3. 性能影响

虽然这条规则提供了灵活性，但也可能会有一些性能影响。每次有请求进来，Nginx 在提供内容之前都要检查多个位置。与更简单的配置相比，这可能会增加少量的开销。不过，对于大多数应用程序来说，其在灵活性和用户体验方面的优势要大于这点性能上的小影响。

## 结论

实现了静态和动态内容的无缝整合，提高了 SEO 和用户体验，并提供了处理动态参数的方法。正确的配置以及对性能影响的考虑对于确保 Web 服务器的顺畅运行至关重要。